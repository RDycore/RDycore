
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="development.html">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Code Structure and Organization - RDycore: A River / Flooding dynamical core for E3SM</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rdycore-code-structure-and-organization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="RDycore: A River / Flooding dynamical core for E3SM" class="md-header__button md-logo" aria-label="RDycore: A River / Flooding dynamical core for E3SM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RDycore: A River / Flooding dynamical core for E3SM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Code Structure and Organization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/RDycore/RDycore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="RDycore: A River / Flooding dynamical core for E3SM" class="md-nav__button md-logo" aria-label="RDycore: A River / Flooding dynamical core for E3SM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RDycore: A River / Flooding dynamical core for E3SM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/RDycore/RDycore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/input.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAML Input Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/mms.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MMS Driver
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="development.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Code Structure and Organization
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="organization.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Code Structure and Organization
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-brief-tour-of-rdycores-source-tree" class="md-nav__link">
    <span class="md-ellipsis">
      A Brief Tour of RDycore's Source Tree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-rdycore-object-and-its-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      The RDycore Object and its Lifecycle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#computational-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Computational Domain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Computational Domain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regions" class="md-nav__link">
    <span class="md-ellipsis">
      Regions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      Boundaries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operators" class="md-nav__link">
    <span class="md-ellipsis">
      Operators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#riemann-flux-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Riemann Flux operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Source operator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input" class="md-nav__link">
    <span class="md-ellipsis">
      Input
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    <span class="md-ellipsis">
      Visualization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-series" class="md-nav__link">
    <span class="md-ellipsis">
      Time series
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checkpoints-and-restarts" class="md-nav__link">
    <span class="md-ellipsis">
      Checkpoints and Restarts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-ensembles" class="md-nav__link">
    <span class="md-ellipsis">
      Running Ensembles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running Ensembles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ensemble-configuration-process" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble configuration process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#differences-between-ensemble-mode-and-single-simulation-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Differences between "ensemble mode" and "single-simulation mode"
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support-for-fortran" class="md-nav__link">
    <span class="md-ellipsis">
      Support for Fortran
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Support for Fortran">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#special-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Special considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-brief-tour-of-rdycores-source-tree" class="md-nav__link">
    <span class="md-ellipsis">
      A Brief Tour of RDycore's Source Tree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-rdycore-object-and-its-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      The RDycore Object and its Lifecycle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#computational-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Computational Domain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Computational Domain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regions" class="md-nav__link">
    <span class="md-ellipsis">
      Regions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      Boundaries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operators" class="md-nav__link">
    <span class="md-ellipsis">
      Operators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#riemann-flux-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Riemann Flux operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Source operator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input" class="md-nav__link">
    <span class="md-ellipsis">
      Input
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    <span class="md-ellipsis">
      Visualization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-series" class="md-nav__link">
    <span class="md-ellipsis">
      Time series
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checkpoints-and-restarts" class="md-nav__link">
    <span class="md-ellipsis">
      Checkpoints and Restarts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-ensembles" class="md-nav__link">
    <span class="md-ellipsis">
      Running Ensembles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running Ensembles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ensemble-configuration-process" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble configuration process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#differences-between-ensemble-mode-and-single-simulation-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Differences between "ensemble mode" and "single-simulation mode"
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support-for-fortran" class="md-nav__link">
    <span class="md-ellipsis">
      Support for Fortran
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Support for Fortran">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#special-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Special considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="rdycore-code-structure-and-organization">RDycore Code Structure and Organization</h1>
<p>In this section, we describe the organization of RDycore's source files. We have
attempted to group functions and data types together into subsystems that can
be easily understood separately from one another.</p>
<h2 id="a-brief-tour-of-rdycores-source-tree">A Brief Tour of RDycore's Source Tree</h2>
<p>The root level of the <a href="https://github.com/RDycore/RDycore">RDycore</a> source tree
contains a <code>README.md</code> file, a <code>CMakeLists.txt</code> file that defines the build
system, and some configuration files for documentation and tooling.</p>
<p>There are several folders at the root of the source tree:</p>
<div class="highlight"><pre><span></span><code>+ RDyore +- [.github/workflows](https://github.com/RDycore/RDycore/tree/main/.github/workflows]
         |
         +- [cmake](https://github.com/RDycore/RDycore/tree/main/cmake)
         |
         +- [config](https://github.com/RDycore/RDycore/tree/main/config)
         |
         +- [docs](https://github.com/RDycore/RDycore/tree/main/docs)
         |
         +- [driver](https://github.com/RDycore/RDycore/tree/main/driver)
         |
         +- [external](https://github.com/RDycore/RDycore/tree/main/external)
         |
         +- [include](https://github.com/RDycore/RDycore/tree/main/include)
         |
         +- [share](https://github.com/RDycore/RDycore/tree/main/share)
         |
         +- [src](https://github.com/RDycore/RDycore/tree/main/src)
         |
         +- [tools](https://github.com/RDycore/RDycore/tree/main/src)
</code></pre></div>
<ul>
<li><code>.github/workflows</code>: workflows that support our <a href="development.html#GitHub-Continuous-Integration-Environment">GitHub Continuous Integration
  Environment</a></li>
<li><code>cmake</code>: CMake scripts that support the build system, testing, etc.</li>
<li><code>config</code>: shell scripts to help with running RDycore on our target platforms</li>
<li><code>docs</code>: Markdown source files for our <a href="https://squidfunk.github.io/mkdocs-material/">mkdocs</a>-based
  documentation</li>
<li><code>driver</code>: C and Fortran driver programs, including the standalone RDycore
  drivers and a few other development tools</li>
<li><code>external</code>: third-party libraries used by RDycore that aren't provided by
  PETSc</li>
<li><code>include</code>: the <code>rdycore.h</code> API header file, and all private header files
  (located within the <code>private</code> subfolder)</li>
<li><code>share</code>: data files for initial conditions, material properties, and
  unstructured grids (used mainly for testing)</li>
<li><code>src</code>: the source code for RDycore</li>
<li><code>tools</code>: miscellaneous tools and scripts for building and deploying Docker
  images</li>
</ul>
<p>Take a look at each of these folders to familiarize yourself with their
contents. In particular, the <code>src</code> folder has a few important subfolders:</p>
<ul>
<li><code>src/f90-mod</code>: the RDycore Fortran module that mirrors the C library's
  capabilities</li>
<li><code>src/swe</code>: functions and data structures specific to the solution of the
  2D shallow water equations</li>
<li><code>src/tests</code>: unit tests for subsystems within RDycore</li>
</ul>
<p>The private headers in the <code>include</code> folder contain definitions of opaque types
and functions that are helpful throughout RDycore but are not part of the API.</p>
<p>The <code>driver</code> folder also has its own <code>tests</code> subfolder that defines tests
that run the standalone drivers and perform convergence tests for selected
problems.</p>
<h2 id="the-rdycore-object-and-its-lifecycle">The RDycore Object and its Lifecycle</h2>
<p>RDycore (the "river dynamical core") is represented in code by a data structure
called <code>RDy</code>, declared as an opaque type in <a href="https://github.com/RDycore/RDycore/tree/main/include/rdycore.h">include/rdycore.h</a>.
It is defined in <a href="https://github.com/RDycore/RDycore/tree/main/include/private/rdycoreimpl.h">include/private/rdycoreimpl.h</a>.
In this section, we describe how to manipulate <code>RDy</code> to set up and run
simulations. It may be helpful to refer to the <a href="https://github.com/RDycore/RDycore/tree/main/driver/main.c">standalone C driver</a>
(and or the corresponding <a href="https://github.com/RDycore/RDycore/tree/main/driver/main.F90">Fortran driver</a>)
as you read this section.</p>
<ol>
<li><strong>Initialization</strong></li>
</ol>
<p>Before RDycore can be used in any program, the supporting systems must be
initialized with a call to <code>RDyInit</code>:</p>
<div class="highlight"><pre><span></span><code>  // initialize RDycore subsystems
  PetscCall(RDyInit(argc, argv, helpString));
</code></pre></div>
<p>This function accepts the <code>argc</code> and <code>argv</code> command line argument parameters
accepted by any C program, plus a string printed to display help/usage
information.</p>
<p>Next, create an <code>RDy</code> object, passing it an MPI communicator, the path to a
<a href="../common/input.html">YAML input file</a>, and the pointer to the desired <code>RDy</code>
object:</p>
<div class="highlight"><pre><span></span><code>  // create an RDy on the given communicator with the given input
  RDy rdy;
  PetscCall(RDyCreate(MPI_COMM_WORLD, &quot;my-input.yaml&quot;, &amp;rdy));
</code></pre></div>
<p>This only creates the object--it does not read input or allocate any resources
for the problem described within the input.</p>
<ol>
<li><strong>Setup</strong></li>
</ol>
<p>To read the input file and ready your <code>RDy</code> object to run the simulation
defined therein, call <code>RDySetup</code>:</p>
<div class="highlight"><pre><span></span><code>  // read input and set up the dycore
  PetscCall(RDySetup(rdy));
</code></pre></div>
<p>After this call, you're ready to run a simulation. You can also all any query
or utility functions on your <code>RDy</code> object to do whatever you need for your own
simulation. For example, you might need information about the unstructured grid,
or perhaps you are specifying specific boundary values for a Dirichlet boundary
condition. See the API header file for all the possibilities.</p>
<ol>
<li><strong>Timestepping</strong></li>
</ol>
<p>The simplest way to start running your simulation after setup is to run
<code>RDyAdvance</code> (which takes a single step) within a <code>while</code> loop that uses
<code>RDyFinished</code> as termination condition:</p>
<div class="highlight"><pre><span></span><code>  // run the simulation to completion
  while (!RDyFinished(rdy)) {
    // ... pre-step logic here ...

    // advance the simulation by a single step
    PetscCall(RDyAdvance(rdy));

    // ... post-step logic here ...
  }
</code></pre></div>
<p>If you look in the standalone C driver, you can see various pre- and post-step
logic to accommodate data transfer, restarts, etc.</p>
<ol>
<li><strong>Finalization</strong></li>
</ol>
<p>At the end of an RDycore-enabled program, you must destroy the <code>RDy</code> object with
a call to <code>RDyDestroy</code>:</p>
<div class="highlight"><pre><span></span><code>  // destroy the dycore
  PetscCall(RDyDestroy(&amp;rdy));
</code></pre></div>
<p>Finally, call <code>RDyFinalize</code> to reclaim all resources used by RDycore and its
subsystems:</p>
<div class="highlight"><pre><span></span><code>  // clean up
  PetscCall(RDyFinalize());
</code></pre></div>
<h2 id="computational-domain">Computational Domain</h2>
<p>RDycore solves equations on a topologically-two-dimensional domain with
topography represented by an elevation coordinate <span class="arithmatex">\(z(x, y)\)</span>.</p>
<p>RDycore uses two objects to represent the computional domain:</p>
<ul>
<li><a href="https://petsc.org/release/manual/dmplex/">DMPlex</a>: a PETSc data structure
  that stores the minimum set of information needed to define an unstructured
  grid</li>
<li><a href="https://github.com/RDycore/RDycore/blob/main/include/private/rdymeshimpl.h">RDyMesh</a>:
  An RDycore-specific data structure (implementation <a href="https://github.com/RDycore/RDycore/blob/main/src/rdymesh.c">here</a>)
  that stores data for cells, edges, and vertices, constructed using the
  <code>DMPlex</code> object</li>
</ul>
<p>Both of these objects are created by a call to <code>RDySetup</code>. The <code>RDyMesh</code> object
is a simple container with</p>
<ul>
<li>metadata like numbers of cells, edges, vertices</li>
<li>a <code>cells</code> field that stores cell data in an <code>RDyCells</code> data structure</li>
<li>an <code>edges</code> field that stores edge data in an <code>RDyEdges</code> data structure</li>
<li>a <code>vertices</code> field that stores vertex data in an <code>RDyVertices</code> data structure</li>
<li>metadata useful for output/visualization</li>
</ul>
<p>The domain is partitioned into disjoint <em>regions</em>, each of which consists of a
set of contiguous <em>cells</em>, usually triangles or quads. Additionally, the domain
is bounded by one or more <em>boundaries</em>, each of which consists of a set of
edges (which can be thought of as two-dimensional "faces"). We describe how
regions and boundaries work below.</p>
<h3 id="regions">Regions</h3>
<p>When a mesh file is read to create a <code>DMPlex</code> object during <a href="https://github.com/RDycore/RDycore/blob/main/src/rdysetup.c">RDySetup</a>,
<a href="https://petsc.org/release/manualpages/DMLabel/">DMLabel</a> objects are created
that represent disjoint sets of cells. Each cell set represents a region. From
each label/cell set, RDycore constructs an <a href="https://github.com/RDycore/RDycore/blob/main/include/private/rdycoreimpl.h#L20">RDyRegion</a>,
which is basically a named array of local cell IDs.</p>
<p>RDycore then uses information in the <a href="../common/input.html">YAML input file</a> to
associate initial condition and source data with each region by name. This
process is implemented in <a href="https://github.com/RDycore/RDycore/blob/main/src/rdysetup.c#L182">InitRegions</a>.</p>
<h3 id="boundaries">Boundaries</h3>
<p>Similarly to regions, the <code>DMPlex</code> object created during <code>RDySetup</code> constructs
<code>DMLabel</code> objects represents disjoint sets of edges, each of which represents a
boundary. From each label/edge set, RDycore constructs an <a href="https://github.com/RDycore/RDycore/blob/main/include/private/rdycoreimpl.h#L29">RDyBoundary</a>,
a named array of local edge IDs.</p>
<p>RDycore then uses information in the <a href="../common/input.html">YAML input file</a> to
associate boundary condition data with each boundary by name. This process is
implemented in <a href="https://github.com/RDycore/RDycore/blob/main/src/rdysetup.c#L244">InitBoundaries</a>.</p>
<h2 id="operators">Operators</h2>
<p><strong>NOTE</strong>: at the time of writing, RDycore solves the shallow water equations
exclusively, so everything here refers to operators pertaining only to these
equations.</p>
<h3 id="riemann-flux-operator">Riemann Flux operator</h3>
<h3 id="source-operator">Source operator</h3>
<h2 id="input">Input</h2>
<p>The parsing of input is dispatched from <a href="https://github.com/RDycore/RDycore/blob/main/src/rdysetup.c#L244">RDySetup</a>
and implemented in <a href="https://github.com/RDycore/RDycore/blob/main/src/yaml_input.c#L1173">ReadConfigFile</a>.
At the top of <code>yaml_input.c</code>, several structs are defined that represent a YAML
"schema". In this "schema," each struct represents a YAML mapping object, with
fields in the mapping corresponding to fields in the struct. Accordinglhy, YAML
arrays within mappings are represented by array fields.</p>
<p>For a more detailed explanation of how this YAML schema is parsed, see the
<a href="https://github.com/tlsa/libcyaml/blob/main/docs/guide.md">libcyaml documentation</a>.</p>
<h2 id="output">Output</h2>
<h3 id="visualization">Visualization</h3>
<h3 id="time-series">Time series</h3>
<h2 id="checkpoints-and-restarts">Checkpoints and Restarts</h2>
<h2 id="running-ensembles">Running Ensembles</h2>
<h3 id="ensemble-configuration-process">Ensemble configuration process</h3>
<h3 id="differences-between-ensemble-mode-and-single-simulation-mode">Differences between "ensemble mode" and "single-simulation mode"</h3>
<h2 id="support-for-fortran">Support for Fortran</h2>
<p>A Fortran version of the public C interface is available in an <a href="https://github.com/RDycore/RDycore/blob/main/src/f90-mod/rdycore.F90"><code>rdycore</code> Fortran module</a>
in the <code>src/f90-mod</code> directory. This module is hand-written and uses the
<a href="https://fortranwiki.org/fortran/show/iso_c_binding">Fortran 2003 <code>iso_c_binding</code></a>
standard intrinsic module to map C functions to equivalent Fortran subroutines
and functions, and defines appropriate data types.</p>
<p>The mapping from a C function to a Fortran subroutine (or function) is
accomplished in two parts:</p>
<ol>
<li>
<p>A C function is made available to Fortran by defining a Fortran function
   (or function) using a <code>bind(C)</code> annotation specifying the case-sensitive name
   of the C function. All data types in this Fortran function must correspond to
   supported C data types via the <code>iso_c_binding</code> module. The function returns
   an integer corresponding to the <code>PetscErrorCode</code> return type of the C
   function. We refer to such a function as a "C-bound Fortran function".</p>
</li>
<li>
<p>A Fortran "wrapper" subroutine is defined that calls the C-bound Fortran
   function defined in item 1. This subroutine follows the PETSc convention in
   which the last argument (<code>ierr</code>) gets the return value of the C-bound Fortran
   function.</p>
</li>
</ol>
<p>Whenever a new C function is added to the public interface in <code>rdycore.h</code>, these
two corresponding Fortran items must be added to support its use in Fortran.</p>
<h3 id="special-considerations">Special considerations</h3>
<ul>
<li><strong>C pointers</strong>: Perhaps counterintuitively, C pointers must be passed by value
  to Fortran-bound C functions. In other words, any argument of type <code>type(c_ptr)</code>
  must have the <code>value</code> attribute and <code>intent(in)</code>. You can think of a pointer
  as a memory location, which is morally equivalent to an integer of the
  appropriate size. The <code>intent(in)</code> expresses that the pointer itself remains
  unchanged even if the data it points to is modified by the function.
  <strong>NOTE</strong>: an <code>RDy</code> C object is expressed as a C pointer in the Fortran module.</li>
<li><strong>C primitives</strong>: Because C passes arguments to functions by value and Fortran
  by reference, it is necessary to add the <code>value</code> attribute to any parameter
  in a C-bound Fortran function that has a non-pointer C type. This includes
  most <code>intent(in)</code> primitive parameters in C-bound Fortran functions. Note
  that <code>intent(out)</code> parameters in these functions must necessarily be pointers
  in C functions, so they must not have the <code>value</code> attribute.</li>
<li><strong>Enumerated types</strong>: An enumerated type in C can be mapped to Fortran as a
  set of related integer parameters. See, for example, the way <a href="https://github.com/RDycore/RDycore/blob/main/src/f90-mod/rdycore.F90#L35">time units</a>
  are expressed in the <code>rdycore</code> Fortran module.</li>
<li><strong>PETSc types</strong>: PETSc types like <code>Vec</code> are passed to C-bound Fortran
  functions as <code>PetscFortranAddr</code> with the <code>value</code> attribute and <code>intent(in)</code>.
  This is very similar to the way we treat C pointers, with some magic PETSc
  pixie dust sprinkled on it to satisfy conditions required by PETSc.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indices", "navigation.instant", "navigation.sections", "navigation.top"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="../javascript/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>