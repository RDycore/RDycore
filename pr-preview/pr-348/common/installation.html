
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../developer/index.html">
      
      
        <link rel="next" href="../developer/development.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Installation - RDycore: A River / Flooding dynamical core for E3SM</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="RDycore: A River / Flooding dynamical core for E3SM" class="md-header__button md-logo" aria-label="RDycore: A River / Flooding dynamical core for E3SM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RDycore: A River / Flooding dynamical core for E3SM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Installation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/RDycore/RDycore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="RDycore: A River / Flooding dynamical core for E3SM" class="md-nav__button md-logo" aria-label="RDycore: A River / Flooding dynamical core for E3SM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    RDycore: A River / Flooding dynamical core for E3SM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/RDycore/RDycore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="installation.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#required-software" class="md-nav__link">
    <span class="md-ellipsis">
      Required Software
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Required Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#which-version-of-petsc" class="md-nav__link">
    <span class="md-ellipsis">
      Which version of PETSc?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Clone the Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-rdycore" class="md-nav__link">
    <span class="md-ellipsis">
      Configure RDycore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure RDycore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#supported-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Supported configuration options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations-for-apple-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations for Apple hardware
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-test-and-install-rdycore" class="md-nav__link">
    <span class="md-ellipsis">
      Build, Test, and Install RDycore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build, Test, and Install RDycore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Running Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#measuring-code-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Measuring Code Coverage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-memory-errors-and-leaks-with-valgrind" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for memory errors and leaks with Valgrind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-code-changes-and-rebuilding" class="md-nav__link">
    <span class="md-ellipsis">
      Making code changes and rebuilding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preinstalled-petsc-for-rdycore-on-certain-doe-machines" class="md-nav__link">
    <span class="md-ellipsis">
      Preinstalled PETSc for RDycore on certain DOE machines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preinstalled PETSc for RDycore on certain DOE machines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-perlmutter-cpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Perlmutter CPU nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-perlmutter-gpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Perlmutter GPU nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-frontier" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Frontier
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frequently-asked-questions-faq" class="md-nav__link">
    <span class="md-ellipsis">
      Frequently Asked Questions (FAQ)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="input.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    YAML Input Specification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mms.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MMS Driver
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    RDycore Example Cases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            RDycore Example Cases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/example-cases/example-cases.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/example-cases/dam-break/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Idealized dam break problem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_3" >
        
          
          <label class="md-nav__link" for="__nav_2_5_3" id="__nav_2_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hurricane Harvey
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_3">
            <span class="md-nav__icon md-icon"></span>
            Hurricane Harvey
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/example-cases/harvey-flooding/harvey-flooding.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/example-cases/harvey-flooding/critical-outflow-bc/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    With MRMS rainfall and outflow BC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/example-cases/harvey-flooding/ocean-bc/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    With average rainfall and ocean BC
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    E3SM-RDycore Example Cases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            E3SM-RDycore Example Cases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/example-cases/e3sm-cases/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user/example-cases/e3sm-cases/harvey-flooding/e3sm_harvey.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hurricane Harvey
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="installation.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#required-software" class="md-nav__link">
    <span class="md-ellipsis">
      Required Software
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Required Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#which-version-of-petsc" class="md-nav__link">
    <span class="md-ellipsis">
      Which version of PETSc?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Clone the Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-rdycore" class="md-nav__link">
    <span class="md-ellipsis">
      Configure RDycore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure RDycore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#supported-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Supported configuration options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations-for-apple-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations for Apple hardware
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-test-and-install-rdycore" class="md-nav__link">
    <span class="md-ellipsis">
      Build, Test, and Install RDycore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build, Test, and Install RDycore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Running Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#measuring-code-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Measuring Code Coverage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-memory-errors-and-leaks-with-valgrind" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for memory errors and leaks with Valgrind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-code-changes-and-rebuilding" class="md-nav__link">
    <span class="md-ellipsis">
      Making code changes and rebuilding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preinstalled-petsc-for-rdycore-on-certain-doe-machines" class="md-nav__link">
    <span class="md-ellipsis">
      Preinstalled PETSc for RDycore on certain DOE machines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preinstalled PETSc for RDycore on certain DOE machines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-perlmutter-cpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Perlmutter CPU nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-perlmutter-gpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Perlmutter GPU nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-frontier" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Frontier
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frequently-asked-questions-faq" class="md-nav__link">
    <span class="md-ellipsis">
      Frequently Asked Questions (FAQ)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/development.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Process
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/organization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Structure and Organization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/style.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Style Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/ceed.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SWE implementation using libCEED
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Theory Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Theory Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/swe.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shallow Water Equations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/sediment.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sediment Transport
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#required-software" class="md-nav__link">
    <span class="md-ellipsis">
      Required Software
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Required Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#which-version-of-petsc" class="md-nav__link">
    <span class="md-ellipsis">
      Which version of PETSc?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Clone the Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-rdycore" class="md-nav__link">
    <span class="md-ellipsis">
      Configure RDycore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure RDycore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#supported-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Supported configuration options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations-for-apple-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations for Apple hardware
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-test-and-install-rdycore" class="md-nav__link">
    <span class="md-ellipsis">
      Build, Test, and Install RDycore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build, Test, and Install RDycore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Running Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#measuring-code-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Measuring Code Coverage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-memory-errors-and-leaks-with-valgrind" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for memory errors and leaks with Valgrind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-code-changes-and-rebuilding" class="md-nav__link">
    <span class="md-ellipsis">
      Making code changes and rebuilding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preinstalled-petsc-for-rdycore-on-certain-doe-machines" class="md-nav__link">
    <span class="md-ellipsis">
      Preinstalled PETSc for RDycore on certain DOE machines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preinstalled PETSc for RDycore on certain DOE machines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-perlmutter-cpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Perlmutter CPU nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-perlmutter-gpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Perlmutter GPU nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-building-and-running-rdycore-on-frontier" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Building and running RDycore on Frontier
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frequently-asked-questions-faq" class="md-nav__link">
    <span class="md-ellipsis">
      Frequently Asked Questions (FAQ)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="installation">Installation</h1>
<p>You can build and run RDycore on the following platforms:</p>
<ul>
<li>Linux and Mac laptops and workstations</li>
<li><a href="https://www.olcf.ornl.gov/frontier/">Frontier</a> (Oak Ridge National Laboratory)</li>
<li><a href="https://docs.nersc.gov/systems/perlmutter/">Perlmutter</a> (NERSC)</li>
</ul>
<h2 id="required-software">Required Software</h2>
<p>To build RDycore, you need:</p>
<ul>
<li><a href="https://cmake.org/">CMake v3.14+</a> for configuration</li>
<li><a href="https://www.gnu.org/software/make/">GNU Make</a> or <a href="https://ninja-build.org/">Ninja</a>
  for compilation and testing</li>
<li>reliable C, C++, and Fortran compilers</li>
<li>a working MPI installation (like <a href="https://www.open-mpi.org/">OpenMPI</a>
  or <a href="https://www.mpich.org/">MPICH</a>)</li>
<li><a href="https://petsc.org/release/">PETSc</a>, built with the following third-party
  libraries:<ul>
<li>cgns</li>
<li>exodusii</li>
<li>fblaslapack</li>
<li>hdf5</li>
<li>libceed</li>
<li>metis</li>
<li>muparser</li>
<li>netcdf</li>
<li>parmetis</li>
<li>pnetcdf</li>
<li>zlib</li>
</ul>
</li>
</ul>
<p>You can obtain all of these freely on the Linux and Mac platforms. On Linux,
just use your favorite package manager. On a Mac, you can get the Clang C/C++
compiler by installing XCode, and then use a package manager like
<a href="https://brew.sh/">Homebrew</a> or <a href="https://www.macports.org/">MacPorts</a> to get
the rest.</p>
<h3 id="which-version-of-petsc">Which version of PETSc?</h3>
<p>Check <a href="https://github.com/RDycore/RDycore/blob/main/.github/workflows/auto_test.yml#L24">our automated testing workflow</a>
for the proper Git hash to use to build RDycore. The linked line specifies a
Docker image containing the "blessed" version of PETSc, which can be read as
follows:</p>
<div class="highlight"><pre><span></span><code>coherellc/rdycore-petsc:fc288817-int32
</code></pre></div>
<ul>
<li><code>coherellc</code> is the name of the DockerHub organization hosting the image</li>
<li><code>rdycore-petsc</code> is the the name of the Docker image</li>
<li><code>fc288817</code> is the Git hash within the <a href="https://gitlab.com/petsc/petsc">PETSc repository</a>
  used to build RDycore</li>
<li><code>int32</code> (or <code>int64</code>) indicates whether the PETSc installation within the image
  uses 32-bit or 64-bit integers for the <code>PetscInt</code> data type.</li>
</ul>
<p>See our <a href="https://github.com/RDycore/RDycore/blob/main/tools/Dockerfile.petsc#L50">PETSc Dockerfile</a>
for an example of the <code>configure</code> command we use to build PETSc in our continous
integration environment.</p>
<h2 id="clone-the-repository">Clone the Repository</h2>
<p>First, go get the <a href="https://github.com/RDycore/RDycore">source code</a>
at GitHub:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">SSH</label><label for="__tabbed_1_2">HTTPS</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:RDycore/RDycore.git
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/RDycore/RDycore.git
</code></pre></div>
</div>
</div>
</div>
<p>This places an <code>RDycore</code> folder into your current path. Then we need to update the submodules.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>RDycore
git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>--recursive
</code></pre></div>
<h2 id="configure-rdycore">Configure RDycore</h2>
<p>RDycore uses CMake, and can be easily configured as long as
<a href="https://petsc.org/release/install/">PETSc is installed</a> and <a href="https://petsc.org/release/install/multibuild/#environmental-variables-petsc-dir-and-petsc-arch">the <code>PETSC_DIR</code>
and <code>PETSC_ARCH</code> environment variables are set
properly</a>.
Usually all you need to do is change to your <code>RDycore</code> source directory and type</p>
<div class="highlight"><pre><span></span><code>cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build
</code></pre></div>
<p>where <code>build</code> is the name of your build directory relative to the source
directory. If you want to install RDycore somewhere afterward, e.g. to be able
to configure E3SM to use it, you can set the prefix for the installation path
using the <code>CMAKE_INSTALL_PREFIX</code> parameter:</p>
<div class="highlight"><pre><span></span><code>cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/path/to/install
</code></pre></div>
<p>If you want build RDycore with Ninja instead of Make, you can ask CMake to
generate Ninja files instead of Makefiles with the <code>-G</code> (generator) flag:</p>
<div class="highlight"><pre><span></span><code>cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-G<span class="w"> </span>Ninja
</code></pre></div>
<h3 id="supported-configuration-options">Supported configuration options</h3>
<p>CMake allows you to specify build options with the <code>-D</code> flag, as indicated in
Step 3 above. Here are the options supported by RDycore:</p>
<ul>
<li><strong><code>CMAKE_INSTALL_PREFIX=/path/to/install</code></strong>: a path to which the RDycore library
  and driver are installed with <code>make install</code> (as in Step 7)</li>
<li><strong><code>CMAKE_BUILD_TYPE=Debug|Release</code></strong>: controls whether a build has debugging
  information or whether it is optimized</li>
<li><strong><code>CMAKE_VERBOSE_MAKEFILE=ON|OFF</code></strong>: if <code>ON</code>, displays compiler and linker
  output while building. Otherwise displays only the file being built.</li>
<li><strong><code>ENABLE_COVERAGE=ON|OFF</code></strong>: if <code>ON</code>, enables code coverage instrumentation.</li>
<li><strong><code>ENABLE_FORTRAN=ON|OFF</code></strong>: if <code>ON</code>, enables Fortran 90 bindings. This is <code>ON</code>
  by default, but can be used to work around situations in which Fortran compilers
  are causing issues.</li>
</ul>
<p>Since RDycore gets most of its configuration information from PETSc, we don't
need to use most other CMake options.</p>
<h3 id="considerations-for-apple-hardware">Considerations for Apple hardware</h3>
<p>If you're on a Mac, make sure you have installed the XCode Command Line Tools.
If you have, these tools should be located in
<code>/Library/Developer/CommandLineTools/usr/bin/</code>, so add this directory to your
<code>PATH</code>.</p>
<h2 id="build-test-and-install-rdycore">Build, Test, and Install RDycore</h2>
<p>After you've configured RDycore, you can build it:</p>
<ol>
<li>Change to your build directory (e.g. <code>cd build</code>)</li>
<li>Type <code>make -j</code> or <code>ninja</code> to build the library.</li>
<li>To run tests for the library (and the included drivers), type <code>make test</code> or
   <code>ninja test</code>.</li>
<li>To install the model to the location (indicated by your <code>CMAKE_INSTALL_PREFIX</code>,
   if you specified it), type <code>make install</code> or <code>ninja install</code>. By default,
   products are installed in the <code>include</code>, <code>lib</code>, <code>bin</code>, and <code>share</code>
   subdirectories of this prefix.</li>
</ol>
<h3 id="running-tests">Running Tests</h3>
<p>RDycore uses <a href="https://cmake.org/cmake/help/book/mastering-cmake/chapter/Testing%20With%20CMake%20and%20CTest.html">CTest</a>,
CMake's testing program, to run its tests. CTest is very fancy and allows us to
run tests selectively and in various ways, but all you need to do to run all the
tests for RDycore is to change to your build directory and type</p>
<div class="highlight"><pre><span></span><code>make test
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>ninja test
</code></pre></div>
<p>This runs every test defined in your build configuration and dumps the results
to <code>Testing/Temporary/LastTest.log</code>.</p>
<h3 id="measuring-code-coverage">Measuring Code Coverage</h3>
<p>RDycore can use <a href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">gcov</a> or
<a href="https://lcov.readthedocs.io/en/latest/index.html">lcov</a> to analyze code
coverage (the fraction of source code that is exercised by programs and tests)
with the GCC or Clang compilers.</p>
<p>To instrument the <code>rdycore</code> library and unit tests for code coverage analysis,
pass the <code>-DENABLE_COVERAGE=ON</code> flag to CMake when configuring your build. Then,
after building and running tests, type</p>
<div class="highlight"><pre><span></span><code>make coverage
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>ninja coverage
</code></pre></div>
<p>to generate a single report (<code>coverage.info</code>) containing all coverage
information. See the documentation for <code>gcov</code> and <code>lcov</code> (linked above) for
details on how to interpret thіs information.</p>
<h3 id="checking-for-memory-errors-and-leaks-with-valgrind">Checking for memory errors and leaks with Valgrind</h3>
<p>If you're using a Linux system and have <a href="https://valgrind.org/">Valgrind</a>
installed, you can run our tests using Valgrind's <code>memcheck</code> tool with</p>
<div class="highlight"><pre><span></span><code>make memcheck
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>ninja memcheck
</code></pre></div>
<h2 id="making-code-changes-and-rebuilding">Making code changes and rebuilding</h2>
<p>Notice that you must build RDycore in a  <strong>build tree</strong>, separate from its source
trees. This is standard practice in CMake-based build systems, and it allows you
to build several different configurations without leaving generated and compiled
files all over your source directory. However, you might have to change the way
you work in order to be productive in this kind of environment.</p>
<p>When you make a code change, make sure you build from the build directory that
you created in step 1 above:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/path/to/RDycore/build
make<span class="w"> </span>-j<span class="w">  </span><span class="c1"># or ninja</span>
</code></pre></div>
<p>You can also run tests from this build directory with <code>make test</code>.</p>
<p>This is very different from how some people like to work. One method of making
this easier is to use an editor in a dedicated window, and have another window
open with a terminal, sitting in your <code>build</code> directory. If you're using a fancy
modern editor, it might have a CMake-based workflow that handles all of this for
you.</p>
<p>The build directory has a structure that mirrors the source directory. If you're
using Make (and not Ninja) to build RDycore, you can type <code>make</code> in any one of
its subdirectories to do partial builds. In practice, though, it's safest to
always build from the top of the build tree.</p>
<h2 id="preinstalled-petsc-for-rdycore-on-certain-doe-machines">Preinstalled PETSc for RDycore on certain DOE machines</h2>
<p>The RDycore team supports installation of the model at following DOE machines:</p>
<ol>
<li><a href="https://docs.nersc.gov/systems/perlmutter/">Perlmutter</a> at NERSC</li>
<li><a href="https://docs.olcf.ornl.gov/systems/frontier_user_guide.html">Frontier</a> at OLCF</li>
</ol>
<p>First, run the following shell script to set PETSc-related environmental variables and load appropriate modules.</p>
<div class="highlight"><pre><span></span><code><span class="sb">`</span><span class="nb">source</span><span class="w"> </span>config/set_petsc_settings.sh<span class="w"> </span>--mach<span class="w"> </span>&lt;machine_name&gt;<span class="w"> </span>--config<span class="w"> </span>&lt;configuration&gt;<span class="sb">`</span>,
</code></pre></div>
<p>Multiple configurations of PETSc have been pre-installed on these supported machines
under RDycore's project directories. Information about the available PETSc configurations
can be obtained via <code>./config/set_petsc_settings.sh</code>.</p>
<p>The Perlmutter system has two types of compute nodes: CPU-only and CPU-GPU nodes, and
RDycore needs to be build separately for each type of compute node. The CPU-only nodes
have 128 cores (2 x 64-core AMD EPYC CPUs), while the CPU-GPU nodes have
1 x 64-core AMD EPYC CPU and 4 x NVIDIA A100. RDycore uses PETSc's and libCEED's support
of CUDA to run on Perlmutter GPUs.</p>
<p>Frontier has a single type of compute node that has 64-core AMD and 4x AMD MI250X GPUs.
Each GPU has 2 Graphics Compute Dies (GCDs) for a total of 8 GCDs per node. Of the 64-cores,
only 56 are allocatable cores instead of 64 cores. RDycore uses PETSc's and libCEED's
support of HIP to run on AMD GPUs.</p>
<p><strong>NOTE: Replace <code>make -j4</code> with <code>ninja</code> below to use Ninja instead of Make.</strong></p>
<h3 id="example-building-and-running-rdycore-on-perlmutter-cpu-nodes">Example: Building and running RDycore on Perlmutter CPU nodes</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/path/to/RDycore

<span class="c1"># Set PETSc environment variables for Perlmutter CPU nodes</span>
<span class="nb">source</span><span class="w"> </span>config/set_petsc_settings.sh<span class="w"> </span>--mach<span class="w"> </span>pm-cpu<span class="w"> </span>--config<span class="w"> </span><span class="m">1</span>

<span class="c1"># Build RDycore</span>
cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build-<span class="nv">$PETSC_ARCH</span><span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$PWD</span>/build-<span class="nv">$PETSC_ARCH</span>
<span class="nb">cd</span><span class="w"> </span>build-<span class="nv">$PETSC_ARCH</span>
make<span class="w"> </span>-j4<span class="w"> </span>install

<span class="c1"># Use an interactive job queue</span>
salloc<span class="w"> </span>--nodes<span class="w"> </span><span class="m">1</span><span class="w"> </span>--qos<span class="w"> </span>interactive<span class="w"> </span>--time<span class="w"> </span><span class="m">00</span>:30:00<span class="w"> </span>--constraint<span class="w"> </span>cpu<span class="w"> </span><span class="se">\</span>
--account<span class="o">=</span>&lt;project-id&gt;

<span class="c1"># Change to the directory containing tests</span>
<span class="nb">cd</span><span class="w"> </span>driver/tests/swe_roe

<span class="c1"># Run on 4 MPI tasks on CPUs</span>
srun<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>../../rdycore<span class="w"> </span>ex2b_ic_file.yaml<span class="w"> </span>-ceed<span class="w"> </span>/cpu/self<span class="w"> </span>-log_view
</code></pre></div>
<h3 id="example-building-and-running-rdycore-on-perlmutter-gpu-nodes">Example: Building and running RDycore on Perlmutter GPU nodes</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/path/to/RDycore

<span class="c1"># Set PETSc environment variables for Perlmutter GPU nodes</span>
<span class="nb">source</span><span class="w"> </span>config/set_petsc_settings.sh<span class="w"> </span>--mach<span class="w"> </span>pm-gpu<span class="w"> </span>--config<span class="w"> </span><span class="m">1</span>

<span class="c1"># Build RDycore</span>
cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build-<span class="nv">$PETSC_ARCH</span><span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$PWD</span>/build-<span class="nv">$PETSC_ARCH</span>
<span class="nb">cd</span><span class="w"> </span>build-<span class="nv">$PETSC_ARCH</span>
make<span class="w"> </span>-j4<span class="w"> </span>install

<span class="c1"># Use an interactive job queue</span>
salloc<span class="w"> </span>--nodes<span class="w"> </span><span class="m">1</span><span class="w"> </span>--qos<span class="w"> </span>interactive<span class="w"> </span>--time<span class="w"> </span><span class="m">00</span>:30:00<span class="w"> </span>--constraint<span class="w"> </span>gpu<span class="w"> </span><span class="se">\</span>
--gpus<span class="w"> </span><span class="m">4</span><span class="w"> </span>--account<span class="o">=</span>&lt;project-id&gt;_g

<span class="c1"># Change to the directory containing tests</span>
<span class="nb">cd</span><span class="w"> </span>driver/tests/swe_roe

<span class="c1"># Run on 4 GPUs using CUDA</span>
srun<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>-c<span class="w"> </span><span class="m">32</span><span class="w"> </span>../../rdycore<span class="w"> </span>ex2b_ic_file.yaml<span class="w"> </span><span class="se">\</span>
-ceed<span class="w"> </span>/gpu/cuda<span class="w"> </span>-dm_vec_type<span class="w"> </span>cuda<span class="w"> </span>-log_view<span class="w"> </span>-log_view_gpu_time
</code></pre></div>
<h3 id="example-building-and-running-rdycore-on-frontier">Example: Building and running RDycore on Frontier</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/path/to/RDycore

<span class="c1"># Set PETSc environment variables for Frontier</span>
<span class="nb">source</span><span class="w"> </span>config/set_petsc_settings.sh<span class="w"> </span>--mach<span class="w"> </span>frontier<span class="w"> </span>--config<span class="w"> </span><span class="m">1</span>

<span class="c1"># Build RDycore</span>
cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build-<span class="nv">$PETSC_ARCH</span><span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$PWD</span>/build-<span class="nv">$PETSC_ARCH</span>
<span class="nb">cd</span><span class="w"> </span>build-<span class="nv">$PETSC_ARCH</span>
make<span class="w"> </span>-j4<span class="w"> </span>install

<span class="c1"># Use an interactive job queue</span>
salloc<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-A<span class="w"> </span>&lt;project-id&gt;<span class="w"> </span>-t<span class="w"> </span><span class="m">0</span>:30:00<span class="w"> </span>-p<span class="w"> </span>batch

<span class="c1"># Change to the directory containing tests</span>
<span class="nb">cd</span><span class="w"> </span>driver/tests/swe_roe

<span class="c1"># Run on CPUs</span>
srun<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n8<span class="w"> </span>-c1<span class="w"> </span>../../rdycore<span class="w"> </span>ex2b_ic_file.yaml<span class="w"> </span>-ceed<span class="w"> </span>/cpu/self<span class="w"> </span>-log_view

<span class="c1"># Run on 8 GPUs using HIP</span>
srun<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n8<span class="w"> </span>-c1<span class="w"> </span>../../rdycore<span class="w"> </span>ex2b_ic_file.yaml<span class="w"> </span><span class="se">\</span>
-ceed<span class="w"> </span>/gpu/hip<span class="w"> </span>-dm_vec_type<span class="w"> </span>hip<span class="w"> </span>-log_view<span class="w"> </span>-log_view_gpu_time
</code></pre></div>
<h2 id="frequently-asked-questions-faq">Frequently Asked Questions (FAQ)</h2>
<p><strong>When I try to configure RDycore, PETSc is not found! I get an error message
like this:</strong></p>
<div class="highlight"><pre><span></span><code>-- Checking for module &#39;PETSc&#39;
--   No package &#39;PETSc&#39; found
CMake Error at &lt;gibberish&gt;
  A required package was not found
Call Stack (most recent call first):
  &lt;more gibberish&gt;/Modules/FindPkgConfig.cmake:829 (_pkg_check_modules_internal)
  CMakeLists.txt:39 (pkg_check_modules)


-- Configuring incomplete, errors occurred!
</code></pre></div>
<p><strong>How do I tell CMake where to find PETSc?</strong></p>
<p>RDycore uses the UNIX <code>pkg-config</code> tool to figure out where PETSc is installed.
Specifically, it looks for a file named <code>&lt;package-name&gt;.pc</code> that contains
relevant information about the installation. You can tell it where to search
using the <code>PKG_CONFIG_PATH</code> environment variable similarly to how you use the
<code>PATH</code> variable to search for the UNIX commands you use.</p>
<p>Typically, PETSc installs <code>PETSc.pc</code> in the following location:</p>
<div class="highlight"><pre><span></span><code>$PETSC_DIR/$PETSC_ARCH/lib/pkgconfig/PETSc.pc
</code></pre></div>
<p>So if you modify <code>PKG_CONFIG_PATH</code> to contain <code>$PETSC_DIR/$PETSC_ARCH/lib/pkgconfig</code>,
(e.g. <code>export PKG_CONFIG_PATH="$PETSC_DIR/$PETSC_ARCH/lib/pkgconfig:$PKG_CONFIG_PATH"</code>),
CMake can find your PETSc installation. This is probably required if you are
installing PETSc in a peculiar place.</p>
<p><strong>When I type <code>make</code>, it builds some things and then just sits there for hours!
What's going on?</strong></p>
<p>Currently (around April 8, 2025), CMake is not able to generate Makefiles for
PETSc's Fortran bindings, so you should use Ninja instead to build RDycore. Just
add <code>-G Ninja</code> to your CMake configuration command and use <code>ninja</code> instead of
<code>make</code> (without the <code>-j</code> flag, as Ninja always does parallel builds).</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indices", "navigation.instant", "navigation.sections", "navigation.top"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../javascript/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>